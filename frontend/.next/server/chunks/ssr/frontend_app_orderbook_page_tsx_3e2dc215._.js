module.exports=[46861,a=>{"use strict";var b=a.i(57850),c=a.i(91786),d=a.i(10713),e=a.i(91939),f=a.i(93846),g=a.i(21130),h=a.i(45056),i=a.i(76987),j=a.i(62340),k=a.i(54700),l=a.i(86107),m=a.i(360),n=a.i(32664),o=a.i(94606),p=a.i(55570);function q(a={}){let{enabled:b=!0,onLogs:c,config:d,...e}=a,f=(0,p.useConfig)(a),g=(0,o.useChainId)({config:f}),i=a.chainId??g;(0,h.useEffect)(()=>{if(b&&c)return function(a,b){let c,d,{syncConnectedChain:e=a._internal.syncConnectedChain,...f}=b,g=b=>{c&&c();let d=a.getClient({chainId:b});return c=(0,n.getAction)(d,m.watchContractEvent,"watchContractEvent")(f)},h=g(b.chainId);return e&&!b.chainId&&(d=a.subscribe(({chainId:a})=>a,async a=>g(a))),()=>{h?.(),d?.()}}(f,{...e,chainId:i,onLogs:c})},[i,f,b,c,e.abi,e.address,e.args,e.batch,e.eventName,e.fromBlock,e.onError,e.poll,e.pollingInterval,e.strict,e.syncConnectedChain])}var r=a.i(2884),s=a.i(74001),t=a.i(16492);let u=r.CONTRACT_ADDRESSES.mantleSepoliaTestnet.marketplace;function v(){let a=(0,l.useWriteContract)();return{useListing:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"listings",args:[a],chainId:t.mantleSepoliaTestnet.id}),useOffer:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"offers",args:[a],chainId:t.mantleSepoliaTestnet.id}),usePriceBounds:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"priceBounds",args:[a],chainId:t.mantleSepoliaTestnet.id}),useActiveListings:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"getActiveListings",args:[a],chainId:t.mantleSepoliaTestnet.id}),useBestAsk:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"getBestAsk",args:[a],chainId:t.mantleSepoliaTestnet.id}),useUserActiveListings:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"getUserActiveListings",args:a?[a]:void 0,chainId:t.mantleSepoliaTestnet.id,query:{enabled:!!a}}),getSuggestedPrice:a=>(0,k.useReadContract)({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"getSuggestedPrice",args:[a],chainId:t.mantleSepoliaTestnet.id}),createListing:{writeContractAsync:async({args:b})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"createListing",args:b,chainId:t.mantleSepoliaTestnet.id})},buyListing:{writeContractAsync:async({args:b,value:c})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"buyListing",args:b,value:c,chainId:t.mantleSepoliaTestnet.id})},cancelListing:{writeContractAsync:async({args:b})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"cancelListing",args:b,chainId:t.mantleSepoliaTestnet.id})},makeOffer:{writeContractAsync:async({args:b,value:c})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"makeOffer",args:b,value:c,chainId:t.mantleSepoliaTestnet.id})},acceptOffer:{writeContractAsync:async({args:b})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"acceptOffer",args:b,chainId:t.mantleSepoliaTestnet.id})},cancelOffer:{writeContractAsync:async({args:b})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"cancelOffer",args:b,chainId:t.mantleSepoliaTestnet.id})},updatePriceBounds:{writeContractAsync:async({args:b})=>a.writeContractAsync({address:u,abi:s.ServiceTokenMarketplaceABI,functionName:"updatePriceBounds",args:b,chainId:t.mantleSepoliaTestnet.id})},watchListingCreated:a=>q({address:u,abi:s.ServiceTokenMarketplaceABI,eventName:"ListingCreated",onLogs:a,chainId:t.mantleSepoliaTestnet.id}),watchListingSold:a=>q({address:u,abi:s.ServiceTokenMarketplaceABI,eventName:"ListingPurchased",onLogs:a,chainId:t.mantleSepoliaTestnet.id}),watchOfferMade:a=>q({address:u,abi:s.ServiceTokenMarketplaceABI,eventName:"OfferMade",onLogs:a,chainId:t.mantleSepoliaTestnet.id}),watchOfferAccepted:a=>q({address:u,abi:s.ServiceTokenMarketplaceABI,eventName:"OfferAccepted",onLogs:a,chainId:t.mantleSepoliaTestnet.id})}}var w=a.i(44412),x=a.i(40320);function y(){let[a,e]=(0,h.useState)(BigInt(1)),{address:i}=(0,x.useAccount)();return(0,b.jsxs)("main",{className:"min-h-screen",children:[(0,b.jsx)(c.Navigation,{}),(0,b.jsx)("section",{className:"pt-32 pb-20 px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-12",children:[(0,b.jsx)("h1",{className:"text-5xl font-bold mb-4 text-balance",children:"Order Book Marketplace"}),(0,b.jsx)("p",{className:"text-xl text-muted-foreground text-pretty",children:"Trade service tokens peer-to-peer with price bounds and dynamic discounts."})]}),(0,b.jsxs)(d.Card,{className:"p-6 mb-8 border-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Select Service Token"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(f.Input,{type:"number",min:"1",value:a.toString(),onChange:a=>e(BigInt(a.target.value||"1")),placeholder:"Token ID",className:"max-w-[200px]"}),(0,b.jsx)(z,{tokenId:a})]})]}),(0,b.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,b.jsxs)("div",{className:"lg:col-span-2",children:[(0,b.jsxs)(d.Card,{className:"p-6 border-2",children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold mb-6",children:["Order Book - Token #",a.toString()]}),(0,b.jsx)(A,{tokenId:a})]}),(0,b.jsx)(d.Card,{className:"p-6 border-2 mt-8",children:(0,b.jsxs)(g.Tabs,{defaultValue:"listings",children:[(0,b.jsxs)(g.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsx)(g.TabsTrigger,{value:"listings",children:"My Listings"}),(0,b.jsx)(g.TabsTrigger,{value:"offers",children:"My Offers"})]}),(0,b.jsx)(g.TabsContent,{value:"listings",children:(0,b.jsx)(F,{userAddress:i})}),(0,b.jsx)(g.TabsContent,{value:"offers",children:(0,b.jsx)(H,{userAddress:i})})]})})]}),(0,b.jsxs)("div",{className:"lg:col-span-1",children:[(0,b.jsx)(d.Card,{className:"p-6 border-2 sticky top-24",children:(0,b.jsxs)(g.Tabs,{defaultValue:"sell",children:[(0,b.jsxs)(g.TabsList,{className:"grid w-full grid-cols-2 mb-6",children:[(0,b.jsx)(g.TabsTrigger,{value:"sell",children:"Sell"}),(0,b.jsx)(g.TabsTrigger,{value:"buy",children:"Buy"})]}),(0,b.jsx)(g.TabsContent,{value:"sell",children:(0,b.jsx)(C,{tokenId:a})}),(0,b.jsx)(g.TabsContent,{value:"buy",children:(0,b.jsx)(D,{tokenId:a})})]})}),(0,b.jsxs)(d.Card,{className:"p-6 border-2 mt-4",children:[(0,b.jsx)("h3",{className:"font-bold mb-4",children:"Price Information"}),(0,b.jsx)(E,{tokenId:a})]})]})]})]})}),(0,b.jsx)("footer",{className:"border-t border-border py-12 px-4 sm:px-6 lg:px-8",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto text-center text-sm text-muted-foreground",children:"© 2025 ServiceFi. Built on Mantle Network."})})]})}function z({tokenId:a}){let{useServiceInfo:c}=(0,w.useServiceCredit)(),d=c(a);if(!d.data)return(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading..."});let e=d.data[0],f=d.data[1],g=Math.floor(Date.now()/1e3),h=Math.floor((Number(f)-g)/86400);return(0,b.jsxs)("div",{className:"flex gap-6 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Fixed Price: "}),(0,b.jsxs)("span",{className:"font-bold",children:[(0,i.formatEther)(e)," MNT"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Expires in: "}),(0,b.jsxs)("span",{className:"font-bold",children:[h," days"]})]})]})}function A({tokenId:a}){let{useActiveListings:c,useBestAsk:d}=v(),e=c(a),f=d(a);if(e.isLoading)return(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading order book..."});let g=e.data||[];return 0===g.length?(0,b.jsxs)("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"No active listings for this token"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Be the first to create a listing!"})]}):(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-6 p-4 bg-muted/50 rounded-lg",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Best Ask"}),(0,b.jsx)("div",{className:"text-2xl font-bold",children:f.data?`${(0,i.formatEther)(f.data)} MNT`:"—"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-xs font-medium text-muted-foreground pb-2 border-b",children:[(0,b.jsx)("div",{children:"SELLER"}),(0,b.jsx)("div",{className:"text-right",children:"AMOUNT"}),(0,b.jsx)("div",{className:"text-right",children:"ASK PRICE"}),(0,b.jsx)("div",{className:"text-right",children:"ACTION"})]}),g.map(a=>(0,b.jsx)(B,{listingId:a},a.toString()))]})]})}function B({listingId:a}){let{useListing:c,buyListing:d}=v(),{address:g}=(0,x.useAccount)(),j=c(a),[k,l]=(0,h.useState)("1"),[m,n]=(0,h.useState)(!1);if(!j.data||!j.data[7])return null;let o=j.data[1],p=j.data[3],q=j.data[4],r=g&&o.toLowerCase()===g.toLowerCase(),s=async()=>{if(!(!k||1>Number(k))){n(!0);try{let b=q*BigInt(k);await d.writeContractAsync({args:[a,BigInt(k)],value:b})}catch(a){console.error("Buy failed:",a)}finally{n(!1)}}};return(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 items-center py-3 border-b hover:bg-muted/50 transition-colors",children:[(0,b.jsxs)("div",{className:"font-mono text-xs",children:[o.slice(0,6),"...",o.slice(-4)]}),(0,b.jsx)("div",{className:"text-right font-medium",children:p.toString()}),(0,b.jsxs)("div",{className:"text-right font-bold text-accent",children:[(0,i.formatEther)(q)," MNT"]}),(0,b.jsx)("div",{className:"text-right",children:r?(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Your listing"}):(0,b.jsxs)("div",{className:"flex gap-1 justify-end",children:[(0,b.jsx)(f.Input,{type:"number",min:"1",max:p.toString(),value:k,onChange:a=>l(a.target.value),className:"w-16 h-8 text-xs"}),(0,b.jsx)(e.Button,{size:"sm",onClick:s,disabled:m||!k,className:"h-8 text-xs",children:m?"...":"Buy"})]})})]})}function C({tokenId:a}){let{createListing:c,getSuggestedPrice:d}=v(),{useBalance:g}=(0,w.useServiceCredit)(),{address:k}=(0,x.useAccount)(),l=g(k,a),m=d(a),[n,o]=(0,h.useState)(""),[p,q]=(0,h.useState)(""),[r,s]=(0,h.useState)("7"),[t,u]=(0,h.useState)(!1),y=async()=>{if(n&&p){u(!0);try{await c.writeContractAsync({args:[a,BigInt(n),(0,j.parseEther)(p),Number(r)]}),o(""),q("")}catch(a){console.error("Create listing failed:",a)}finally{u(!1)}}},z=l.data?Number(l.data):0;return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Your Balance: ",z," tokens"]}),(0,b.jsx)(f.Input,{type:"number",min:"1",max:z,value:n,onChange:a=>o(a.target.value),placeholder:"Amount to sell"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Ask Price (MNT per token)",m.data&&(0,b.jsxs)("span",{className:"ml-2 text-xs text-accent",children:["Suggested: ",(0,i.formatEther)(m.data)]})]}),(0,b.jsx)(f.Input,{type:"number",step:"0.01",value:p,onChange:a=>q(a.target.value),placeholder:"0.00"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Price must be within 90-105% of fixed price"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Listing Duration"}),(0,b.jsxs)("select",{value:r,onChange:a=>s(a.target.value),className:"w-full px-4 py-2 border border-input bg-background rounded-md",children:[(0,b.jsx)("option",{value:"1",children:"1 day"}),(0,b.jsx)("option",{value:"3",children:"3 days"}),(0,b.jsx)("option",{value:"7",children:"7 days"}),(0,b.jsx)("option",{value:"14",children:"14 days"}),(0,b.jsx)("option",{value:"30",children:"30 days"})]})]}),n&&p&&(0,b.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"You will sell:"}),(0,b.jsxs)("span",{className:"font-bold",children:[n," tokens"]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"You will receive:"}),(0,b.jsxs)("span",{className:"font-bold",children:[(Number(n)*Number(p)*.98).toFixed(4)," MNT"]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"(2% marketplace fee deducted)"})]}),(0,b.jsx)(e.Button,{onClick:y,disabled:t||!n||!p||Number(n)>z,className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",children:t?"Creating...":"Create Listing"})]})}function D({tokenId:a}){let{makeOffer:c}=v(),[d,g]=(0,h.useState)(""),[i,k]=(0,h.useState)(""),[l,m]=(0,h.useState)(""),[n,o]=(0,h.useState)("3"),[p,q]=(0,h.useState)(!1),r=async()=>{if(d&&i&&l){q(!0);try{let a=(0,j.parseEther)(l)*BigInt(i);await c.writeContractAsync({args:[BigInt(d),BigInt(i),(0,j.parseEther)(l),Number(n)],value:a}),g(""),k(""),m("")}catch(a){console.error("Make offer failed:",a)}finally{q(!1)}}};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Listing ID"}),(0,b.jsx)(f.Input,{type:"number",min:"1",value:d,onChange:a=>g(a.target.value),placeholder:"Enter listing ID"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Amount"}),(0,b.jsx)(f.Input,{type:"number",min:"1",value:i,onChange:a=>k(a.target.value),placeholder:"Tokens to buy"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Bid Price (MNT per token)"}),(0,b.jsx)(f.Input,{type:"number",step:"0.01",value:l,onChange:a=>m(a.target.value),placeholder:"0.00"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Bid must be below the ask price"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Offer Duration"}),(0,b.jsxs)("select",{value:n,onChange:a=>o(a.target.value),className:"w-full px-4 py-2 border border-input bg-background rounded-md",children:[(0,b.jsx)("option",{value:"1",children:"1 day"}),(0,b.jsx)("option",{value:"3",children:"3 days"}),(0,b.jsx)("option",{value:"7",children:"7 days"})]})]}),i&&l&&(0,b.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total cost:"}),(0,b.jsxs)("span",{className:"font-bold",children:[(Number(i)*Number(l)).toFixed(4)," MNT"]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"(Locked until offer accepted or expires)"})]}),(0,b.jsx)(e.Button,{onClick:r,disabled:p||!d||!i||!l,className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",children:p?"Submitting...":"Make Offer"})]})}function E({tokenId:a}){let{usePriceBounds:c,getSuggestedPrice:d}=v(),e=c(a),f=d(a);if(e.isLoading)return(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading..."});let g=e.data;return g?(0,b.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Fixed Price:"}),(0,b.jsxs)("span",{className:"font-bold",children:[(0,i.formatEther)(g[2])," MNT"]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Min Price:"}),(0,b.jsxs)("span",{children:[(0,i.formatEther)(g[0])," MNT"]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Max Price:"}),(0,b.jsxs)("span",{children:[(0,i.formatEther)(g[1])," MNT"]})]}),(0,b.jsx)("div",{className:"pt-3 border-t",children:(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Suggested Price:"}),(0,b.jsxs)("span",{className:"font-bold text-accent",children:[f.data?(0,i.formatEther)(f.data):"—"," MNT"]})]})}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Price bounds: ",Number(g[4])/100,"% - ",Number(g[5])/100,"%"]})]}):null}function F({userAddress:a}){let{useUserActiveListings:c,cancelListing:d}=v(),e=c(a);if(!a)return(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Connect wallet to view listings"});if(e.isLoading)return(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading your listings..."});let f=e.data||[];return 0===f.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"You have no active listings"}):(0,b.jsx)("div",{className:"space-y-4 mt-4",children:f.map(a=>(0,b.jsx)(G,{listingId:a,onCancel:d},a.toString()))})}function G({listingId:a,onCancel:c}){let{useListing:f}=v(),g=f(a),[j,k]=(0,h.useState)(!1);if(!g.data)return null;let l=g.data[2],m=g.data[3],n=g.data[4],o=g.data[6];if(!g.data[7])return null;let p=async()=>{k(!0);try{await c.writeContractAsync({args:[a]})}catch(a){console.error("Cancel failed:",a)}finally{k(!1)}},q=Math.floor(Date.now()/1e3),r=Math.floor((Number(o)-q)/3600);return(0,b.jsx)(d.Card,{className:"p-4 border",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"font-mono text-sm text-muted-foreground",children:["Listing #",a.toString()]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-bold",children:m.toString()})," tokens of"," ",(0,b.jsxs)("span",{className:"font-bold",children:["#",l.toString()]})]}),(0,b.jsxs)("div",{className:"text-lg font-bold text-accent",children:[(0,i.formatEther)(n)," MNT/token"]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Expires in ",r,"h"]})]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:p,disabled:j,children:j?"...":"Cancel"})]})})}function H({userAddress:a}){return a?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)("p",{children:"No active offers"}),(0,b.jsx)("p",{className:"text-xs mt-2",children:"Make an offer on a listing to see it here"})]}):(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Connect wallet to view offers"})}a.s(["default",()=>y],46861)}];

//# sourceMappingURL=frontend_app_orderbook_page_tsx_3e2dc215._.js.map