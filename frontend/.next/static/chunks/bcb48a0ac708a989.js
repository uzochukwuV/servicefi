(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86051,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},18326,e=>{"use strict";var t=e.i(48277),s=e.i(61038),a=e.i(9818),n=e.i(75918),r=e.i(68209),i=e.i(68546),l=e.i(30668),c=e.i(58247),d=e.i(72964),o=e.i(91414),u=e.i(78721),m=e.i(41798),x=e.i(96832),h=e.i(39722),f=e.i(83346);function g(e={}){let{enabled:t=!0,onLogs:s,config:a,...n}=e,r=(0,f.useConfig)(e),i=(0,h.useChainId)({config:r}),c=e.chainId??i;(0,l.useEffect)(()=>{if(t&&s)return function(e,t){let s,a,{syncConnectedChain:n=e._internal.syncConnectedChain,...r}=t,i=t=>{s&&s();let a=e.getClient({chainId:t});return s=(0,x.getAction)(a,m.watchContractEvent,"watchContractEvent")(r)},l=i(t.chainId);return n&&!t.chainId&&(a=e.subscribe(({chainId:e})=>e,async e=>i(e))),()=>{l?.(),a?.()}}(r,{...n,chainId:c,onLogs:s})},[c,r,t,s,n.abi,n.address,n.args,n.batch,n.eventName,n.fromBlock,n.onError,n.poll,n.pollingInterval,n.strict,n.syncConnectedChain])}var p=e.i(95392),j=e.i(33191),b=e.i(28939);let N=p.CONTRACT_ADDRESSES.mantleSepoliaTestnet.marketplace;function v(){let e=(0,u.useWriteContract)();return{useListing:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"listings",args:[e],chainId:b.mantleSepoliaTestnet.id}),useOffer:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"offers",args:[e],chainId:b.mantleSepoliaTestnet.id}),usePriceBounds:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"priceBounds",args:[e],chainId:b.mantleSepoliaTestnet.id}),useActiveListings:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"getActiveListings",args:[e],chainId:b.mantleSepoliaTestnet.id}),useBestAsk:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"getBestAsk",args:[e],chainId:b.mantleSepoliaTestnet.id}),useUserActiveListings:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"getUserActiveListings",args:e?[e]:void 0,chainId:b.mantleSepoliaTestnet.id,query:{enabled:!!e}}),getSuggestedPrice:e=>(0,o.useReadContract)({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"getSuggestedPrice",args:[e],chainId:b.mantleSepoliaTestnet.id}),createListing:{writeContractAsync:async({args:t})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"createListing",args:t,chainId:b.mantleSepoliaTestnet.id})},buyListing:{writeContractAsync:async({args:t,value:s})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"buyListing",args:t,value:s,chainId:b.mantleSepoliaTestnet.id})},cancelListing:{writeContractAsync:async({args:t})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"cancelListing",args:t,chainId:b.mantleSepoliaTestnet.id})},makeOffer:{writeContractAsync:async({args:t,value:s})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"makeOffer",args:t,value:s,chainId:b.mantleSepoliaTestnet.id})},acceptOffer:{writeContractAsync:async({args:t})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"acceptOffer",args:t,chainId:b.mantleSepoliaTestnet.id})},cancelOffer:{writeContractAsync:async({args:t})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"cancelOffer",args:t,chainId:b.mantleSepoliaTestnet.id})},updatePriceBounds:{writeContractAsync:async({args:t})=>e.writeContractAsync({address:N,abi:j.ServiceTokenMarketplaceABI,functionName:"updatePriceBounds",args:t,chainId:b.mantleSepoliaTestnet.id})},watchListingCreated:e=>g({address:N,abi:j.ServiceTokenMarketplaceABI,eventName:"ListingCreated",onLogs:e,chainId:b.mantleSepoliaTestnet.id}),watchListingSold:e=>g({address:N,abi:j.ServiceTokenMarketplaceABI,eventName:"ListingPurchased",onLogs:e,chainId:b.mantleSepoliaTestnet.id}),watchOfferMade:e=>g({address:N,abi:j.ServiceTokenMarketplaceABI,eventName:"OfferMade",onLogs:e,chainId:b.mantleSepoliaTestnet.id}),watchOfferAccepted:e=>g({address:N,abi:j.ServiceTokenMarketplaceABI,eventName:"OfferAccepted",onLogs:e,chainId:b.mantleSepoliaTestnet.id})}}var y=e.i(62413),k=e.i(47793);function T(){let[e,n]=(0,l.useState)(BigInt(1)),{address:c}=(0,k.useAccount)();return(0,t.jsxs)("main",{className:"min-h-screen",children:[(0,t.jsx)(s.Navigation,{}),(0,t.jsx)("section",{className:"pt-32 pb-20 px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-12",children:[(0,t.jsx)("h1",{className:"text-5xl font-bold mb-4 text-balance",children:"Order Book Marketplace"}),(0,t.jsx)("p",{className:"text-xl text-muted-foreground text-pretty",children:"Trade service tokens peer-to-peer with price bounds and dynamic discounts."})]}),(0,t.jsxs)(a.Card,{className:"p-6 mb-8 border-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Select Service Token"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(r.Input,{type:"number",min:"1",value:e.toString(),onChange:e=>n(BigInt(e.target.value||"1")),placeholder:"Token ID",className:"max-w-[200px]"}),(0,t.jsx)(C,{tokenId:e})]})]}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[(0,t.jsxs)(a.Card,{className:"p-6 border-2",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold mb-6",children:["Order Book - Token #",e.toString()]}),(0,t.jsx)(S,{tokenId:e})]}),(0,t.jsx)(a.Card,{className:"p-6 border-2 mt-8",children:(0,t.jsxs)(i.Tabs,{defaultValue:"listings",children:[(0,t.jsxs)(i.TabsList,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(i.TabsTrigger,{value:"listings",children:"My Listings"}),(0,t.jsx)(i.TabsTrigger,{value:"offers",children:"My Offers"})]}),(0,t.jsx)(i.TabsContent,{value:"listings",children:(0,t.jsx)(M,{userAddress:c})}),(0,t.jsx)(i.TabsContent,{value:"offers",children:(0,t.jsx)(E,{userAddress:c})})]})})]}),(0,t.jsxs)("div",{className:"lg:col-span-1",children:[(0,t.jsx)(a.Card,{className:"p-6 border-2 sticky top-24",children:(0,t.jsxs)(i.Tabs,{defaultValue:"sell",children:[(0,t.jsxs)(i.TabsList,{className:"grid w-full grid-cols-2 mb-6",children:[(0,t.jsx)(i.TabsTrigger,{value:"sell",children:"Sell"}),(0,t.jsx)(i.TabsTrigger,{value:"buy",children:"Buy"})]}),(0,t.jsx)(i.TabsContent,{value:"sell",children:(0,t.jsx)(w,{tokenId:e})}),(0,t.jsx)(i.TabsContent,{value:"buy",children:(0,t.jsx)(A,{tokenId:e})})]})}),(0,t.jsxs)(a.Card,{className:"p-6 border-2 mt-4",children:[(0,t.jsx)("h3",{className:"font-bold mb-4",children:"Price Information"}),(0,t.jsx)(B,{tokenId:e})]})]})]})]})}),(0,t.jsx)("footer",{className:"border-t border-border py-12 px-4 sm:px-6 lg:px-8",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto text-center text-sm text-muted-foreground",children:"© 2025 ServiceFi. Built on Mantle Network."})})]})}function C({tokenId:e}){let{useServiceInfo:s}=(0,y.useServiceCredit)(),a=s(e);if(!a.data)return(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading..."});let n=a.data[0],r=a.data[1],i=Math.floor(Date.now()/1e3),l=Math.floor((Number(r)-i)/86400);return(0,t.jsxs)("div",{className:"flex gap-6 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Fixed Price: "}),(0,t.jsxs)("span",{className:"font-bold",children:[(0,c.formatEther)(n)," MNT"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Expires in: "}),(0,t.jsxs)("span",{className:"font-bold",children:[l," days"]})]})]})}function S({tokenId:e}){let{useActiveListings:s,useBestAsk:a}=v(),n=s(e),r=a(e);if(n.isLoading)return(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading order book..."});let i=n.data||[];return 0===i.length?(0,t.jsxs)("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"No active listings for this token"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Be the first to create a listing!"})]}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-6 p-4 bg-muted/50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Best Ask"}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:r.data?`${(0,c.formatEther)(r.data)} MNT`:"—"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-xs font-medium text-muted-foreground pb-2 border-b",children:[(0,t.jsx)("div",{children:"SELLER"}),(0,t.jsx)("div",{className:"text-right",children:"AMOUNT"}),(0,t.jsx)("div",{className:"text-right",children:"ASK PRICE"}),(0,t.jsx)("div",{className:"text-right",children:"ACTION"})]}),i.map(e=>(0,t.jsx)(I,{listingId:e},e.toString()))]})]})}function I({listingId:e}){let{useListing:s,buyListing:a}=v(),{address:i}=(0,k.useAccount)(),d=s(e),[o,u]=(0,l.useState)("1"),[m,x]=(0,l.useState)(!1);if(!d.data||!d.data[7])return null;let h=d.data[1],f=d.data[3],g=d.data[4],p=i&&h.toLowerCase()===i.toLowerCase(),j=async()=>{if(!(!o||1>Number(o))){x(!0);try{let t=g*BigInt(o);await a.writeContractAsync({args:[e,BigInt(o)],value:t})}catch(e){console.error("Buy failed:",e)}finally{x(!1)}}};return(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-4 items-center py-3 border-b hover:bg-muted/50 transition-colors",children:[(0,t.jsxs)("div",{className:"font-mono text-xs",children:[h.slice(0,6),"...",h.slice(-4)]}),(0,t.jsx)("div",{className:"text-right font-medium",children:f.toString()}),(0,t.jsxs)("div",{className:"text-right font-bold text-accent",children:[(0,c.formatEther)(g)," MNT"]}),(0,t.jsx)("div",{className:"text-right",children:p?(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Your listing"}):(0,t.jsxs)("div",{className:"flex gap-1 justify-end",children:[(0,t.jsx)(r.Input,{type:"number",min:"1",max:f.toString(),value:o,onChange:e=>u(e.target.value),className:"w-16 h-8 text-xs"}),(0,t.jsx)(n.Button,{size:"sm",onClick:j,disabled:m||!o,className:"h-8 text-xs",children:m?"...":"Buy"})]})})]})}function w({tokenId:e}){let{createListing:s,getSuggestedPrice:a}=v(),{useBalance:i}=(0,y.useServiceCredit)(),{address:o}=(0,k.useAccount)(),u=i(o,e),m=a(e),[x,h]=(0,l.useState)(""),[f,g]=(0,l.useState)(""),[p,j]=(0,l.useState)("7"),[b,N]=(0,l.useState)(!1),T=async()=>{if(x&&f){N(!0);try{await s.writeContractAsync({args:[e,BigInt(x),(0,d.parseEther)(f),Number(p)]}),h(""),g("")}catch(e){console.error("Create listing failed:",e)}finally{N(!1)}}},C=u.data?Number(u.data):0;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Your Balance: ",C," tokens"]}),(0,t.jsx)(r.Input,{type:"number",min:"1",max:C,value:x,onChange:e=>h(e.target.value),placeholder:"Amount to sell"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Ask Price (MNT per token)",m.data&&(0,t.jsxs)("span",{className:"ml-2 text-xs text-accent",children:["Suggested: ",(0,c.formatEther)(m.data)]})]}),(0,t.jsx)(r.Input,{type:"number",step:"0.01",value:f,onChange:e=>g(e.target.value),placeholder:"0.00"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Price must be within 90-105% of fixed price"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Listing Duration"}),(0,t.jsxs)("select",{value:p,onChange:e=>j(e.target.value),className:"w-full px-4 py-2 border border-input bg-background rounded-md",children:[(0,t.jsx)("option",{value:"1",children:"1 day"}),(0,t.jsx)("option",{value:"3",children:"3 days"}),(0,t.jsx)("option",{value:"7",children:"7 days"}),(0,t.jsx)("option",{value:"14",children:"14 days"}),(0,t.jsx)("option",{value:"30",children:"30 days"})]})]}),x&&f&&(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"You will sell:"}),(0,t.jsxs)("span",{className:"font-bold",children:[x," tokens"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"You will receive:"}),(0,t.jsxs)("span",{className:"font-bold",children:[(Number(x)*Number(f)*.98).toFixed(4)," MNT"]})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"(2% marketplace fee deducted)"})]}),(0,t.jsx)(n.Button,{onClick:T,disabled:b||!x||!f||Number(x)>C,className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",children:b?"Creating...":"Create Listing"})]})}function A({tokenId:e}){let{makeOffer:s}=v(),[a,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[x,h]=(0,l.useState)("3"),[f,g]=(0,l.useState)(!1),p=async()=>{if(a&&c&&u){g(!0);try{let e=(0,d.parseEther)(u)*BigInt(c);await s.writeContractAsync({args:[BigInt(a),BigInt(c),(0,d.parseEther)(u),Number(x)],value:e}),i(""),o(""),m("")}catch(e){console.error("Make offer failed:",e)}finally{g(!1)}}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Listing ID"}),(0,t.jsx)(r.Input,{type:"number",min:"1",value:a,onChange:e=>i(e.target.value),placeholder:"Enter listing ID"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Amount"}),(0,t.jsx)(r.Input,{type:"number",min:"1",value:c,onChange:e=>o(e.target.value),placeholder:"Tokens to buy"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Bid Price (MNT per token)"}),(0,t.jsx)(r.Input,{type:"number",step:"0.01",value:u,onChange:e=>m(e.target.value),placeholder:"0.00"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Bid must be below the ask price"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Offer Duration"}),(0,t.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-input bg-background rounded-md",children:[(0,t.jsx)("option",{value:"1",children:"1 day"}),(0,t.jsx)("option",{value:"3",children:"3 days"}),(0,t.jsx)("option",{value:"7",children:"7 days"})]})]}),c&&u&&(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Total cost:"}),(0,t.jsxs)("span",{className:"font-bold",children:[(Number(c)*Number(u)).toFixed(4)," MNT"]})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"(Locked until offer accepted or expires)"})]}),(0,t.jsx)(n.Button,{onClick:p,disabled:f||!a||!c||!u,className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",children:f?"Submitting...":"Make Offer"})]})}function B({tokenId:e}){let{usePriceBounds:s,getSuggestedPrice:a}=v(),n=s(e),r=a(e);if(n.isLoading)return(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading..."});let i=n.data;return i?(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Fixed Price:"}),(0,t.jsxs)("span",{className:"font-bold",children:[(0,c.formatEther)(i[2])," MNT"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Min Price:"}),(0,t.jsxs)("span",{children:[(0,c.formatEther)(i[0])," MNT"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Max Price:"}),(0,t.jsxs)("span",{children:[(0,c.formatEther)(i[1])," MNT"]})]}),(0,t.jsx)("div",{className:"pt-3 border-t",children:(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Suggested Price:"}),(0,t.jsxs)("span",{className:"font-bold text-accent",children:[r.data?(0,c.formatEther)(r.data):"—"," MNT"]})]})}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Price bounds: ",Number(i[4])/100,"% - ",Number(i[5])/100,"%"]})]}):null}function M({userAddress:e}){let{useUserActiveListings:s,cancelListing:a}=v(),n=s(e);if(!e)return(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Connect wallet to view listings"});if(n.isLoading)return(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading your listings..."});let r=n.data||[];return 0===r.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"You have no active listings"}):(0,t.jsx)("div",{className:"space-y-4 mt-4",children:r.map(e=>(0,t.jsx)(L,{listingId:e,onCancel:a},e.toString()))})}function L({listingId:e,onCancel:s}){let{useListing:r}=v(),i=r(e),[d,o]=(0,l.useState)(!1);if(!i.data)return null;let u=i.data[2],m=i.data[3],x=i.data[4],h=i.data[6];if(!i.data[7])return null;let f=async()=>{o(!0);try{await s.writeContractAsync({args:[e]})}catch(e){console.error("Cancel failed:",e)}finally{o(!1)}},g=Math.floor(Date.now()/1e3),p=Math.floor((Number(h)-g)/3600);return(0,t.jsx)(a.Card,{className:"p-4 border",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"font-mono text-sm text-muted-foreground",children:["Listing #",e.toString()]}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-bold",children:m.toString()})," tokens of"," ",(0,t.jsxs)("span",{className:"font-bold",children:["#",u.toString()]})]}),(0,t.jsxs)("div",{className:"text-lg font-bold text-accent",children:[(0,c.formatEther)(x)," MNT/token"]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Expires in ",p,"h"]})]}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:f,disabled:d,children:d?"...":"Cancel"})]})})}function E({userAddress:e}){return e?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)("p",{children:"No active offers"}),(0,t.jsx)("p",{className:"text-xs mt-2",children:"Make an offer on a listing to see it here"})]}):(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Connect wallet to view offers"})}e.s(["default",()=>T],18326)},94059,e=>{e.v(t=>Promise.all(["static/chunks/2762d9e2dcfb9ae6.js"].map(t=>e.l(t))).then(()=>t(31279)))},91795,e=>{e.v(t=>Promise.all(["static/chunks/d069d921d0a394c7.js"].map(t=>e.l(t))).then(()=>t(18006)))}]);